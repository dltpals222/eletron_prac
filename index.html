<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Program Check</title>
</head>
<body>
  <h1>Program Installation Check</h1>
  <p id="status">Checking...</p>
  <p id="version" style="display: none;"></p>
  <p id="electron-status" style="display: none;"></p>
  <p id="latest-version" style="display: none;"></p>
  <button id="check-again" style="display: none;">Check Again</button>
  <button id="update-button" style="display: none;">Update Electron</button>

  <script>
    async function checkProgram() {
      const response = await fetch('/check-program');
      const data = await response.json();
      const statusElement = document.getElementById('status');
      const versionElement = document.getElementById('version');
      const electronStatusElement = document.getElementById('electron-status');
      const latestVersionElement = document.getElementById('latest-version');

      statusElement.textContent = `${data.program} is installed: ${data.isInstalled}`;
      
      // 설치된 경우 버전 표시
      if (data.isInstalled) {
        versionElement.textContent = `Version: ${data.version}`;
        versionElement.style.display = 'block';
      }
      
      // Electron 설치 여부 표시
      electronStatusElement.textContent = `Electron is installed: ${data.isElectron}`;
      electronStatusElement.style.display = 'block';

      // 최신 버전 표시
      latestVersionElement.textContent = `Latest Version: ${data.latestVersion}`;
      latestVersionElement.style.display = 'block';

      // 설치가 안 되어 있으면 버튼을 보여줌
      if (!data.isInstalled) {
        document.getElementById('check-again').style.display = 'block';
      } else if (data.version !== data.latestVersion) {
        // 설치된 버전과 최신 버전이 다르면 업데이트 버튼 표시
        document.getElementById('update-button').style.display = 'block';
      }
    }

    document.getElementById('check-again').addEventListener('click', checkProgram);

    // 업데이트 버튼 클릭 시 실행
    document.getElementById('update-button').addEventListener('click', () => {
      // run-node.bat를 사용하여 업데이트 실행
      const { exec } = require('child_process');
      exec('C:\\Users\\lw\\Downloads\\testElectron\\run-node.bat', (error) => {
        if (error) {
          console.error(`업데이트 중 오류 발생: ${error}`);
        } else {
          alert('업데이트가 시작되었습니다.');
        }
      });
    });

    // 페이지 로드 시 프로그램 체크
    window.onload = checkProgram;
  </script>
</body>
</html>
